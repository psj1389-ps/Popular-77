<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DOC/DOCX â†’ PDF ë³€í™˜</title>
  <style>
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      padding:24px;
      line-height:1.6;
      background-color:#f8f9fa;
      margin:0;
    }
    .wrap{max-width:720px;margin:0 auto;background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:32px;}
    h1{font-size:28px;margin-bottom:8px;color:#2c3e50;text-align:center;}
    .subtitle{text-align:center;color:#7f8c8d;margin-bottom:32px;font-size:16px;}
    .card{
      border:1px solid #e9ecef;
      border-radius:12px;
      padding:24px;
      margin-top:20px;
      background:#fff;
      box-shadow:0 1px 3px rgba(0,0,0,0.05);
    }
    .card h2{margin-top:0;color:#495057;font-size:18px;}
    input[type="file"]{
      width:100%;
      padding:12px;
      border:2px dashed #dee2e6;
      border-radius:8px;
      background:#f8f9fa;
      cursor:pointer;
      transition:all 0.3s ease;
    }
    input[type="file"]:hover{border-color:#007bff;background:#e3f2fd;}
    button{
      background:#007bff;
      color:white;
      border:none;
      padding:12px 24px;
      border-radius:8px;
      font-size:16px;
      cursor:pointer;
      margin-top:16px;
      width:100%;
      transition:background 0.3s ease;
    }
    button:hover{background:#0056b3;}
    button:disabled{background:#6c757d;cursor:not-allowed;}
    .note{color:#6c757d;font-size:14px;margin-bottom:16px;}
    .result{margin-top:16px;padding:12px;border-radius:6px;}
    .result.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
    .result.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
    .result.processing{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb;}
    pre{
      background:#f8f9fa;
      padding:16px;
      border-radius:8px;
      overflow-x:auto;
      font-size:13px;
      border:1px solid #e9ecef;
    }
    .health-status{margin-bottom:12px;}
    .status-indicator{
      display:inline-block;
      width:12px;
      height:12px;
      border-radius:50%;
      margin-right:8px;
    }
    .status-ok{background:#28a745;}
    .status-error{background:#dc3545;}
    .status-warning{background:#ffc107;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>DOC/DOCX â†’ PDF ë³€í™˜</h1>
    <p class="subtitle">LibreOfficeë¥¼ ì‚¬ìš©í•œ ê³ í’ˆì§ˆ ë¬¸ì„œ ë³€í™˜ ì„œë¹„ìŠ¤</p>

    <div class="card">
      <h2>ğŸ“„ íŒŒì¼ ë³€í™˜</h2>
      <p class="note">DOC ë˜ëŠ” DOCX íŒŒì¼ì„ ì„ íƒí•˜ì—¬ PDFë¡œ ë³€í™˜í•˜ì„¸ìš”.</p>
      <form id="convertForm">
        <input type="file" id="fileInput" name="file" accept=".doc,.docx" required />
        <button type="submit" id="convertBtn">ğŸ”„ PDFë¡œ ë³€í™˜í•˜ê¸°</button>
      </form>
      <div id="status" class="result"></div>
    </div>

    <div class="card">
      <h2>ğŸ” ì„œë¹„ìŠ¤ ìƒíƒœ</h2>
      <div class="health-status">
        <span class="status-indicator" id="statusIndicator"></span>
        <span id="statusText">ìƒíƒœ í™•ì¸ ì¤‘...</span>
      </div>
      <pre id="health"></pre>
    </div>
  </div>

  <script>
    async function fetchHealth(){
      const statusIndicator = document.getElementById('statusIndicator');
      const statusText = document.getElementById('statusText');
      const healthPre = document.getElementById('health');
      
      try{
        const res = await fetch('/health');
        const json = await res.json();
        healthPre.textContent = JSON.stringify(json, null, 2);
        
        // ìƒíƒœ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
        if(json.libreoffice && json.libreoffice.includes('unavailable')){
          statusIndicator.className = 'status-indicator status-error';
          statusText.textContent = 'LibreOffice ì‚¬ìš© ë¶ˆê°€';
        } else if(json.libreoffice && json.libreoffice !== 'unavailable') {
          statusIndicator.className = 'status-indicator status-ok';
          statusText.textContent = 'ì„œë¹„ìŠ¤ ì •ìƒ';
        } else {
          statusIndicator.className = 'status-indicator status-warning';
          statusText.textContent = 'ìƒíƒœ í™•ì¸ í•„ìš”';
        }
      }catch(e){
        healthPre.textContent = 'health ìš”ì²­ ì‹¤íŒ¨: ' + e;
        statusIndicator.className = 'status-indicator status-error';
        statusText.textContent = 'ì„œë¹„ìŠ¤ ì—°ê²° ì‹¤íŒ¨';
      }
    }

    document.getElementById('convertForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = document.getElementById('fileInput').files[0];
      const convertBtn = document.getElementById('convertBtn');
      const status = document.getElementById('status');
      
      if(!file){
        alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
        return;
      }
      
      const fd = new FormData();
      fd.append('file', file);
      
      // UI ìƒíƒœ ì—…ë°ì´íŠ¸
      convertBtn.disabled = true;
      convertBtn.textContent = 'ğŸ”„ ë³€í™˜ ì¤‘...';
      status.className = 'result processing';
      status.textContent = 'íŒŒì¼ì„ PDFë¡œ ë³€í™˜í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
      
      try{
        const res = await fetch('/convert', { method: 'POST', body: fd });
        if(!res.ok){
          const err = await res.json().catch(()=>({error:'unknown'}));
          status.className = 'result error';
          status.textContent = 'âŒ ë³€í™˜ ì‹¤íŒ¨: ' + (err.error || res.statusText);
          return;
        }
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = file.name.replace(/\.(docx?|DOCX?)$/, '.pdf');
        a.click();
        URL.revokeObjectURL(url);
        status.className = 'result success';
        status.textContent = 'âœ… ë³€í™˜ ì™„ë£Œ! PDF íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.';
      }catch(e){
        status.className = 'result error';
        status.textContent = 'âŒ ìš”ì²­ ì‹¤íŒ¨: ' + e.message;
      } finally {
        // UI ìƒíƒœ ë³µì›
        convertBtn.disabled = false;
        convertBtn.textContent = 'ğŸ”„ PDFë¡œ ë³€í™˜í•˜ê¸°';
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
    fetchHealth();
    
    // 30ì´ˆë§ˆë‹¤ ìƒíƒœ ìë™ ê°±ì‹ 
    setInterval(fetchHealth, 30000);
  </script>
</body>
</html>

