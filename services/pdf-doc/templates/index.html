<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF â†” DOCX ë³€í™˜ê¸°</title>
    <style>
        body{font-family:Arial;background:#f5f5f5;margin:0;padding:0}
        
        /* ğŸ”¥ ìƒë‹¨ ê·¸ë¼ë””ì–¸íŠ¸ í—¤ë” ì˜ì—­ */
        .gradient-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }
        
        .gradient-header::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0.3;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="12" cy="8" r="0.6" fill="%23ffffff" opacity="0.18"/><circle cx="37" cy="23" r="1.8" fill="%23ffffff" opacity="0.06"/><circle cx="68" cy="15" r="0.9" fill="%23ffffff" opacity="0.14"/><circle cx="91" cy="42" r="1.3" fill="%23ffffff" opacity="0.09"/><circle cx="24" cy="56" r="0.7" fill="%23ffffff" opacity="0.16"/><circle cx="55" cy="73" r="1.5" fill="%23ffffff" opacity="0.07"/><circle cx="83" cy="88" r="1.1" fill="%23ffffff" opacity="0.11"/><circle cx="6" cy="34" r="2.0" fill="%23ffffff" opacity="0.05"/><circle cx="45" cy="47" r="0.8" fill="%23ffffff" opacity="0.13"/><circle cx="72" cy="61" r="1.2" fill="%23ffffff" opacity="0.10"/><circle cx="18" cy="79" r="0.5" fill="%23ffffff" opacity="0.19"/><circle cx="63" cy="29" r="1.7" fill="%23ffffff" opacity="0.08"/><circle cx="89" cy="18" r="0.9" fill="%23ffffff" opacity="0.15"/><circle cx="31" cy="91" r="1.4" fill="%23ffffff" opacity="0.12"/><circle cx="76" cy="5" r="0.6" fill="%23ffffff" opacity="0.17"/><circle cx="9" cy="67" r="1.6" fill="%23ffffff" opacity="0.06"/><circle cx="52" cy="12" r="1.0" fill="%23ffffff" opacity="0.14"/><circle cx="95" cy="76" r="0.8" fill="%23ffffff" opacity="0.11"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateX(0px) translateY(0px); }
            33% { transform: translateX(-25px) translateY(18px); }
            66% { transform: translateX(22px) translateY(-15px); }
            100% { transform: translateX(0px) translateY(0px); }
        }
        
        .header-content {
            position: relative;
            z-index: 10;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        /* ğŸ”¥ ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ê°€ë¡œë¡œ ë°°ì¹˜ */
        .title-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }
        
        .main-title {
            font-size: 2.8em;
            font-weight: bold;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .main-subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            margin: 0;
            font-weight: 300;
            line-height: 1.4;
        }
        
        /* ğŸ”¥ í™”ì´íŠ¸ ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            background: white;
            max-width: 800px;
            margin: 0 auto;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            min-height: calc(100vh - 300px);
        }
        
        .container-content {
            padding: 40px;
        }
        
        .content-section {
            background: #f8f9fa;
            color: #333;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 1.8em;
            font-weight: bold;
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .section-subtitle {
            font-size: 1.1em;
            color: #666;
            margin: 0;
        }
        
        .upload-area{border:2px dashed #ddd;padding:40px;text-align:center;border-radius:10px;cursor:pointer;margin-top:20px}
        .upload-area:hover{border-color:#667eea;background:#f8f9ff}
        .file-input{display:none}
        .btn{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:16px;transition:all 0.3s ease}
        .btn:hover{background:linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);transform:translateY(-2px)}
        .btn:disabled{background:#6c757d;cursor:not-allowed;transform:none}
        .file-info{background:#f8f9fa;padding:15px;border-radius:8px;margin-top:15px;display:none}
        .quality-options{margin:15px 0;display:none}
        .quality-options label{display:block;margin:8px 0;cursor:pointer}
        .error{background:#f8d7da;color:#721c24;padding:12px;border-radius:8px;margin-top:10px;display:none}
        .success{background:#d4edda;color:#155724;padding:12px;border-radius:8px;margin-top:10px;display:none}
        .loading{display:none;text-align:center;margin-top:20px}
        .spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        .reset-btn{background:#6c757d;margin-left:10px}
        .reset-btn:hover{background:#545b62;transform:translateY(-2px)}
        .button-group{display:flex;justify-content:center;gap:10px;margin-top:20px}
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .title-row {
                flex-direction: column;
                gap: 15px;
            }
            .main-title { 
                font-size: 2.2em; 
            }
            .main-subtitle {
                font-size: 1.1em;
            }
            .container-content {
                padding: 20px;
            }
            .content-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Flash ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning" role="alert" style="margin: 20px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; color: #856404; font-weight: 500;">
          {% for message in messages %}
            <div style="margin-bottom: 5px;">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- ğŸ”¥ ìƒë‹¨ ê·¸ë¼ë””ì–¸íŠ¸ í—¤ë” -->
    <div class="gradient-header">
        <div class="header-content">
            <!-- ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ê°€ë¡œë¡œ ë°°ì¹˜ -->
            <div class="title-row">
                <div class="logo-icon">ğŸ“„</div>
                <h1 class="main-title">PDF â†’ DOCX ë³€í™˜ê¸°</h1>
            </div>
            <p class="main-subtitle">AI ê¸°ë°˜ PDF to DOCX ë³€í™˜ ì„œë¹„ìŠ¤ë¡œ ë¬¸ì„œë¥¼ Word íŒŒì¼ë¡œ ì‰½ê²Œ ë³€í™˜í•˜ì„¸ìš”.</p>
        </div>
    </div>
    
    <!-- ğŸ”¥ í™”ì´íŠ¸ ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <div class="container-content">
            <!-- ì½˜í…ì¸  ì„¹ì…˜ -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">PDF â†’ DOCX ë³€í™˜ê¸°</h2>
                    <p class="section-subtitle">ì•ˆì •ì ì¸ í…ìŠ¤íŠ¸ ê¸°ë°˜ ë³€í™˜</p>
                </div>
                
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="upload-area" id="uploadArea">
                        <div id="uploadText">
                            <h3>íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</h3>
                            <p>PDF íŒŒì¼ì„ í´ë¦­í•˜ì—¬ ì„ íƒ (ìµœëŒ€ 100MB)</p>
                        </div>
                        <input type="file" id="fileInput" class="file-input" accept=".pdf,.docx">
                    </div>
                </form>
                
                <div class="file-info" id="fileInfo">
                    <div id="fileName"></div>
                    <div id="fileSize"></div>
                    
                    <div class="quality-options" id="qualityOptions">
                        <h4>ë³€í™˜ í’ˆì§ˆ ì„ íƒ:</h4>
                        <label><input type="radio" name="quality" value="low" checked> ë¹ ë¥¸ ë³€í™˜ (ê¶Œì¥)</label>
                        <label><input type="radio" name="quality" value="medium"> í‘œì¤€ ë³€í™˜</label>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn" id="convertBtn" onclick="convertFile()">ë³€í™˜í•˜ê¸°</button>
                        <button class="btn reset-btn" id="resetBtn" onclick="resetFile()">íŒŒì¼ ì´ˆê¸°í™”</button>
                    </div>
                </div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                </div>
                
                <div class="error" id="errorMsg"></div>
                <div class="success" id="successMsg"></div>
            </div>
        </div>
    </div>



    <script>
        let selectedFile = null;

        document.getElementById('uploadArea').addEventListener('click', function(e) {
            if (e.target.tagName.toLowerCase() !== 'input') {
                document.getElementById('fileInput').click();
            }
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // íŒŒì¼ í¬ê¸° ì²´í¬
                if (file.size > 100 * 1024 * 1024) {
                    showError(`íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤: ${(file.size/1024/1024).toFixed(1)}MB (ìµœëŒ€ 100MB)`);
                    return;
                }
                
                selectedFile = file;
                document.getElementById('fileName').textContent = `íŒŒì¼ëª…: ${file.name}`;
                document.getElementById('fileSize').textContent = `í¬ê¸°: ${(file.size/1024/1024).toFixed(2)}MB`;
                document.getElementById('fileInfo').style.display = 'block';
                
                // PDF íŒŒì¼ì¸ ê²½ìš°ì—ë§Œ í’ˆì§ˆ ì˜µì…˜ í‘œì‹œ
                if (file.name.toLowerCase().endsWith('.pdf')) {
                    document.getElementById('qualityOptions').style.display = 'block';
                } else {
                    document.getElementById('qualityOptions').style.display = 'none';
                }
                
                hideMessages();
            }
        });

        async function convertFile() {
            if (!selectedFile) return;
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            
            // í’ˆì§ˆ ì„¤ì • ì¶”ê°€
            const quality = document.querySelector('input[name="quality"]:checked')?.value || 'low';
            formData.append('quality', quality);
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('convertBtn').disabled = true;
            document.getElementById('convertBtn').textContent = 'ë³€í™˜ ì¤‘...';
            document.getElementById('loading').style.display = 'block';
            hideMessages();
            
            try {
                console.log('ë³€í™˜ ìš”ì²­ ì‹œì‘:', selectedFile.name, 'í’ˆì§ˆ:', quality);
                
                const response = await fetch('/convert', {
                    method: 'POST',
                    body: formData
                });
                
                // ğŸ”¥ Content-Type ê¸°ë°˜ ì‘ë‹µ ì²˜ë¦¬
                const contentType = response.headers.get('Content-Type') || '';
                console.log('ì‘ë‹µ Content-Type:', contentType);
                
                if (!response.ok) {
                    // ì˜¤ë¥˜ ì‘ë‹µ ì²˜ë¦¬ - Content-Type í™•ì¸
                    if (contentType.includes('application/json')) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'ë³€í™˜ ì‹¤íŒ¨');
                    } else {
                        const errorText = await response.text();
                        throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);
                    }
                }
                
                // ì„±ê³µ ì‘ë‹µ ì²˜ë¦¬
                if (contentType.includes('application/json')) {
                    // JSON ì‘ë‹µ ì²˜ë¦¬
                    const jsonData = await response.json();
                    
                    if (jsonData.success && jsonData.download_url) {
                        // ë‹¤ìš´ë¡œë“œ URLì´ ìˆëŠ” ê²½ìš° ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
                        const downloadUrl = jsonData.download_url;
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = selectedFile.name.replace(/\.[^/.]+$/, '.docx');
                        
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        showSuccess(`ë³€í™˜ ì™„ë£Œ! ${a.download} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.`);
                    } else {
                        // ì¼ë°˜ ë©”ì‹œì§€ ì‘ë‹µ
                        showSuccess(jsonData.message || 'ë³€í™˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                } else {
                    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                    const blob = await response.blob();
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = selectedFile.name.replace(/\.[^/.]+$/, selectedFile.name.toLowerCase().endsWith('.pdf') ? '.docx' : '.pdf');
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    URL.revokeObjectURL(url);
                    
                    showSuccess(`ë³€í™˜ ì™„ë£Œ! ${a.download} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.`);
                }
                
            } catch (error) {
                console.error('ë³€í™˜ ì˜¤ë¥˜:', error);
                showError(error.message || 'ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                // UI ë³µì›
                document.getElementById('convertBtn').disabled = false;
                document.getElementById('convertBtn').textContent = 'ë³€í™˜í•˜ê¸°';
                document.getElementById('loading').style.display = 'none';
            }
        }

        function resetFile() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('qualityOptions').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('convertBtn').disabled = false;
            document.getElementById('convertBtn').textContent = 'ë³€í™˜í•˜ê¸°';
            
            // í’ˆì§ˆ ì„¤ì • ì´ˆê¸°í™”
            document.querySelector('input[name="quality"][value="low"]').checked = true;
            
            hideMessages();
        }

        function showError(msg) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = msg;
            errorDiv.style.display = 'block';
            document.getElementById('successMsg').style.display = 'none';
        }

        function showSuccess(msg) {
            const successDiv = document.getElementById('successMsg');
            successDiv.textContent = msg;
            successDiv.style.display = 'block';
            document.getElementById('errorMsg').style.display = 'none';
        }

        function hideMessages() {
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('successMsg').style.display = 'none';
        }
    </script>
</body>
</html>